server {
  listen 443 ssl spdy;
  server_name <%= @server_name %>;

  ssl_certificate <%= @ssl_cert_location %>;
  ssl_certificate_key <%= @ssl_key_location %>;

  ssl_ciphers <%= @ssl_cipher_suite %>;
  ssl_prefer_server_ciphers on;

  client_max_body_size 512m;
  client_body_buffer_size 1024k;

  auth_basic "Restricted";
  auth_basic_user_file /etc/nginx/.htpasswd;

  location / {
    root /opt/www;
    index index.html;
  }

  location /plex {
    proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;

    # Remove the '/plex' portion of the url
    rewrite /plex(/.*) $1 break;

    # Required for Plex WebSockets
    proxy_http_version      1.1;
    proxy_set_header        Upgrade         $http_upgrade;
    proxy_set_header        Connection      "upgrade";

    # set some headers and proxy stuff.
    proxy_set_header X-Real-IP $proxy_host;
    proxy_set_header X-Forwarded-For $proxy_host;
    proxy_redirect off;
    proxy_set_header        Host            $http_host;

    proxy_pass http://127.0.0.1:32400;
  }

  location /sabnzbd/ {
proxy_connect_timeout   59s;
proxy_send_timeout      600;
proxy_read_timeout      600;
proxy_buffer_size       64k;
proxy_buffers           16 32k;
proxy_pass_header       Set-Cookie;
proxy_hide_header       Vary;
 
proxy_busy_buffers_size         64k;
proxy_temp_file_write_size      64k;
 
proxy_set_header        Accept-Encoding         '';
proxy_ignore_headers    Cache-Control           Expires;
proxy_set_header        Referer                 $http_referer;
proxy_set_header        Host                    $host;
proxy_set_header        Cookie                  $http_cookie;
proxy_set_header        X-Real-IP               $remote_addr;
proxy_set_header        X-Forwarded-Host        $host;
proxy_set_header        X-Forwarded-Server      $host;
proxy_set_header        X-Forwarded-For         $proxy_add_x_forwarded_for;
#proxy_set_header       X-Forwarded-For         $remote_addr;
 
proxy_set_header        X-Forwarded-Port        '443';
proxy_set_header        X-Forwarded-Ssl         on;
proxy_set_header        X-Forwarded-Proto       https;
proxy_set_header        Authorization           '';
 
#proxy_buffering        off;
 
#proxy_redirect        off;
#proxy_redirect        default;
proxy_redirect         http://example.net/ /;
proxy_redirect         https://example.net/ /;
#proxy_redirect        http://$host/ /;
#proxy_redirect        http:// https://;
 
#more_clear_headers    'referer';
#RequestHeader unset   referer
#proxy_hide_header     referer;
#proxy_ignore_headers  referer;


      # proxy_pass  http://127.0.0.1:<%= @sabnzbd_web_port %>/;
      proxy_pass http://localhost:<%= @sabnzbd_web_port %>/sabnzbd/;
      #proxy_redirect  default;
  }

  location /couchpotato {
    proxy_redirect off;
    proxy_set_header Host $http_host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_pass  http://localhost:<%= @couchpotato_web_port %>;
    #rewrite ^/couchpotato/?$ /couchpotato/movie/ permanent;
  }

  location /<%= @sickbeard_web_base %> {
    proxy_redirect off;
    proxy_set_header Host $http_host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_pass  http://localhost:<%= @sickbeard_web_port %>;
  }

  location /<%= @headphones_web_base %> {
    proxy_redirect off;
    proxy_set_header Host $http_host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_pass  http://localhost:<%= @headphones_web_port %>;
  }

  location /<%= @transmission_web_base %> {
    proxy_pass  http://127.0.0.1:<%= @transmission_web_port %>;
    proxy_redirect default;
    proxy_set_header Host $http_host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

}
